<view class="container">
  <!-- æŠ€èƒ½å¡ç‰‡ -->
  <view class="skill-card" wx:if="{{currentSkill}}">
    <view class="skill-header">
      <view class="skill-info">
        <text class="skill-title">{{currentSkill.name}}</text>
        <view class="difficulty-tag">
          <text class="tag-content">{{currentSkill.difficulty}}</text>
        </view>
      </view>
    </view>

    <text class="skill-description">{{currentSkill.description}}</text>

    <view class="steps-container">
      <text class="steps-title">æŠ€å·§æ­¥éª¤ï¼š</text>
      <view class="step" wx:for="{{currentSkill.steps}}" wx:key="index">
        <text class="step-number">{{index+1}}.</text>
        <text class="step-content">{{item.content}}</text>
      </view>
    </view>
  </view>

  <!-- ç»ƒä¹ å®¹å™¨ -->
  <view class="exercises-container">
    <view class="section-header">
      <text class="section-title">æ–­å¥ç»ƒä¹ é¢˜ç›®</text>
      <view class="button-group">
        <view class="generate-button {{isButtonLocked ? 'locked' : ''}}" bindtap="showGenerateMoreModal" wx:if="{{!isButtonLocked}}">
          <text class="generate-icon">â•</text>
          <text class="button-text">ç”Ÿæˆæ›´å¤šé¢˜ç›®</text>
        </view>
        <view class="generate-button locked" wx:if="{{isButtonLocked}}">
          <text class="button-text">è¯·ç¨å({{lockTime}}s)</text>
        </view>
        <!-- æ–°å¢ç­”é¢˜è®°å½•æŒ‰é’® -->
        <view class="record-button" bindtap="goToBreakingHistory">
          <text class="record-icon">ğŸ“</text>
          <text class="button-text">ç­”é¢˜è®°å½•</text>
        </view>
      </view>
    </view>

    <!-- ç»ƒä¹ åˆ—è¡¨ -->
    <view class="exercise-list">
      <block wx:for="{{exerciseList}}" wx:key="id">
        <view class="exercise-card {{animationClass}}" style="min-height: {{exerciseCardHeight}}px;">
          <view class="exercise-header">
            <text class="source">{{item.source_text || 'æ— æ¥æºä¿¡æ¯'}}</text>
            <view class="exercise-info">
              <view class="difficulty-badge difficulty-{{item.difficulty === 'åˆçº§' ? 'primary' : item.difficulty === 'ä¸­çº§' ? 'intermediate' : 'advanced'}}">
                {{item.difficulty || 'åˆçº§'}}
              </view>
            </view>
          </view>

          <!-- é¢˜ç›®å†…å®¹ -->
          <view class="question-content">
            <text class="question-text">{{item.content}}</text>
          </view>

          <!-- ç­”é¢˜æŒ‰é’® -->
          <view class="answer-button" bindtap="startAnswer" data-index="{{index}}" wx:if="{{!item.hasStarted}}">
            <text>å¼€å§‹ç­”é¢˜</text>
          </view>

          <!-- æ–­å¥æ“ä½œåŒº -->
          <view class="answer-section" wx:if="{{item.hasStarted && !item.hasSubmitted}}">
            <text class="answer-instruction">è¯·ç‚¹å‡»æ–‡å­—åé¢çš„ç©ºæ ¼è¿›è¡Œæ–­å¥ï¼š</text>

            <!-- åˆå¹¶åŸé¢˜å±•ç¤ºå’Œæ–­å¥æ“ä½œçš„å®¹å™¨ -->
            <view class="break-container">
              <block wx:for="{{item.originalChars}}" wx:key="index" wx:for-item="char" wx:for-index="charIndex">
                <view class="char-container">
                  <!-- åŸé¢˜å­—ç¬¦ -->
                  <text class="char-text">{{char}}</text>
                  <!-- æ–­å¥ç©ºæ ¼ -->
                  <view class="break-space {{item.breakChars[charIndex] ? 'break-selected' : ''}} {{item.breakAnimating[charIndex] ? 'break-animating' : ''}}" bindtap="toggleBreak" data-exerciseindex="{{index}}" data-charindex="{{charIndex}}">
                    <text class="slash-icon" wx:if="{{item.breakChars[charIndex]}}">/</text>
                    <text class="space-indicator" wx:else>â£</text>
                  </view>
                </view>
              </block>
            </view>

            <view class="submit-button" bindtap="submitAnswer" data-index="{{index}}">
              <text>æäº¤ç­”æ¡ˆ</text>
            </view>
          </view>

          <!-- ç­”æ¡ˆè§£æåŒºåŸŸ -->
          <view class="answer-container" wx:if="{{item.hasSubmitted}}">
            <view class="result-indicator {{item.isCorrect ? 'correct' : 'incorrect'}}">
              <text>{{item.isCorrect ? 'âœ“ å›ç­”æ­£ç¡®' : 'âœ— å›ç­”é”™è¯¯'}}</text>
            </view>

            <view class="answer-section">
              <text class="answer-label">æ­£ç¡®ç­”æ¡ˆ:</text>
              <view class="sentence-break-result">
                <text class="sentence-text">{{item.answer}}</text>
              </view>
            </view>

            <view class="analysis-section">
              <text class="analysis-label">è§£æè¯´æ˜:</text>
              <view class="analysis-text">
                <text>{{item.analysis}}</text>
              </view>
            </view>

            <!-- ä¿®æ”¹éƒ¨åˆ†ï¼šæŒ‰é’®åç§°ç»Ÿä¸€ä¸ºâ€œæ”¶èµ·å…¨éƒ¨â€ -->
            <view class="toggle-button" bindtap="toggleAllAnswers" data-index="{{index}}">
              <text>æ”¶èµ·å…¨éƒ¨</text>
            </view>

            <!-- ä¿®æ”¹éƒ¨åˆ†ï¼šç§»é™¤ detailed-analysis çš„æ˜¾ç¤ºé€»è¾‘ï¼Œç‚¹å‡»â€œæ”¶èµ·å…¨éƒ¨â€åä¸æ˜¾ç¤ºä»»ä½•å†…å®¹ -->
            <!-- ä»¥ä¸‹éƒ¨åˆ†å·²è¢«ç§»é™¤ -->
            <!--
            <view class="detailed-analysis" wx:if="{{item.showDetail}}">
              <text class="detailed-text">è¿™é‡Œæ˜¯æ›´è¯¦ç»†çš„è§£æå†…å®¹...</text>
            </view>
            -->
          </view>
        </view>
      </block>
    </view>

    <!-- ç©ºæ•°æ®æç¤º -->
    <view class="no-data" wx:if="{{exerciseList.length === 0 && !isLoading}}">
      <text>ğŸ“­ æš‚æ— é¢˜ç›®æ•°æ®</text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{isLoading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">æ­£åœ¨åŠ è½½é¢˜ç›®...</text>
  </view>

  <!-- é”™è¯¯æç¤º -->
  <view class="error-container" wx:if="{{loadError}}">
    <view class="error-card">
      <text class="error-icon">âŒ</text>
      <text class="error-message">{{errorMsg}}</text>
      <view class="action-buttons">
        <view class="retry-button" bindtap="retryGenerate">
          <text>é‡è¯•</text>
        </view>
        <view class="back-button" bindtap="goBack">
          <text>è¿”å›</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç”Ÿæˆæ›´å¤šæ¨¡æ€æ¡† -->
  <view class="modal-container" wx:if="{{showGenerateModal}}">
    <view class="modal-backdrop" bindtap="hideGenerateModal"></view>
    <view class="generate-modal">
      <text class="modal-title">ç”Ÿæˆæ›´å¤šé¢˜ç›®</text>
      <text class="modal-text">å»ºè®®å…ˆå®Œæˆæœ¬åœ°é¢˜åº“å†ç”Ÿæˆæ›´å¤šé¢˜ç›®</text>
      <view class="modal-buttons">
        <view class="modal-button cancel" bindtap="hideGenerateModal">
          <text>å–æ¶ˆ</text>
        </view>
        <view class="modal-button confirm" bindtap="confirmGenerateMore">
          <text>ç¡®å®šç”Ÿæˆ</text>
        </view>
      </view>
    </view>
  </view>
</view>