<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="header">
    <text class="title">{{currentSkill.name}}</text>
    <text class="tips">éš¾åº¦ï¼š{{currentSkill.difficulty}}</text>
  </view>

  <!-- æŠ€å·§å¡ç‰‡ -->
  <view class="skill-card">
    <view class="skill-desc">
      <text>{{currentSkill.description}}</text>
    </view>
  </view>

  <!-- é¢˜ç›®åˆ—è¡¨ -->
  <view class="exercise-list">
    <!-- ç©ºçŠ¶æ€æç¤º -->
    <view wx:if="{{exerciseList.length === 0 && !isLoading}}" class="empty-guide">
      <text class="empty-icon">ğŸ“</text>
      <text class="empty-title">æš‚æ— é¢˜ç›®æ•°æ®</text>
      <text class="empty-text">å½“å‰æ²¡æœ‰å¯ç”¨çš„é¢˜ç›®æ•°æ®ï¼Œè¯·å°è¯•é‡æ–°åŠ è½½</text>
      <view class="guide-buttons">
        <button class="guide-button primary" bindtap="retryGenerate">é‡æ–°åŠ è½½é¢˜ç›®</button>
        <button class="guide-button secondary" bindtap="goBack">è¿”å›</button>
      </view>
    </view>
    
    <!-- é¢˜ç›®å¡ç‰‡ -->
    <block wx:for="{{exerciseList}}" wx:key="id">
      <view class="exercise-card">
        <view class="exercise-header">
          <text class="index">é¢˜ç›®{{index + 1}}</text>
          <view class="exercise-info">
            <view class="difficulty-badge difficulty-{{item.difficulty === 'åˆçº§' ? 'primary' : item.difficulty === 'ä¸­çº§' ? 'intermediate' : 'advanced'}}">
              {{item.difficulty || 'åˆçº§'}}
            </view>
            <text class="source" wx:if="{{item.source_text}}">æ¥æº: {{item.source_text}}</text>
          </view>
        </view>
        <view class="content">
          <text>{{item.content}}</text>
        </view>
        
        <!-- å¼€å§‹ç­”é¢˜æŒ‰é’® -->
        <view class="answer-button" bindtap="startAnswer" data-index="{{index}}" wx:if="{{!item.hasStarted}}">
          <text>å¼€å§‹ç­”é¢˜</text>
        </view>

        <!-- æ–­å¥æ“ä½œåŒº -->
        <view class="answer-section" wx:if="{{item.hasStarted && !item.hasSubmitted}}">
          <text class="answer-instruction">è¯·ç‚¹å‡»æ–‡å­—åé¢çš„ç©ºæ ¼è¿›è¡Œæ–­å¥ï¼š</text>

          <!-- åˆå¹¶åŸé¢˜å±•ç¤ºå’Œæ–­å¥æ“ä½œçš„å®¹å™¨ -->
          <view class="break-container">
            <block wx:for="{{item.originalChars}}" wx:key="index" wx:for-item="char" wx:for-index="charIndex">
              <view class="char-container">
                <!-- åŸé¢˜å­—ç¬¦ -->
                <text class="char-text">{{char}}</text>
                <!-- æ–­å¥ç©ºæ ¼ -->
                <view class="break-space {{item.breakChars[charIndex] ? 'break-selected' : ''}} {{item.breakAnimating[charIndex] ? 'break-animating' : ''}}" 
                      bindtap="toggleBreak" data-exerciseindex="{{index}}" data-charindex="{{charIndex}}">
                  <text class="slash-icon" wx:if="{{item.breakChars[charIndex]}}">/</text>
                  <text class="space-indicator" wx:else>â£</text>
                </view>
              </view>
            </block>
          </view>

          <view class="submit-button" bindtap="submitAnswer" data-index="{{index}}">
            <text>æäº¤ç­”æ¡ˆ</text>
          </view>
        </view>

        <!-- ç­”æ¡ˆè§£æåŒºåŸŸ -->
        <view class="answer-container" wx:if="{{item.hasSubmitted}}">
          <view class="result-indicator {{item.isCorrect ? 'correct' : 'incorrect'}}">
            <text>{{item.isCorrect ? 'âœ“ å›ç­”æ­£ç¡®' : 'âœ— å›ç­”é”™è¯¯'}}</text>
          </view>

          <view class="answer-section">
            <text class="answer-label">æ­£ç¡®ç­”æ¡ˆ:</text>
            <view class="sentence-break-result">
              <text class="sentence-text">{{item.answer}}</text>
            </view>
          </view>

          <view class="analysis-section">
            <text class="analysis-label">è§£æè¯´æ˜:</text>
            <view class="analysis-text">
              <text>{{item.analysis}}</text>
            </view>
          </view>

          <!-- æ”¶èµ·å…¨éƒ¨æŒ‰é’® -->
          <view class="toggle-button" bindtap="toggleAllAnswers" data-index="{{index}}">
            <text>æ”¶èµ·å…¨éƒ¨</text>
          </view>
        </view>
      </view>
    </block>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{isLoading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">é¢˜ç›®ç”Ÿæˆä¸­ï¼Œè¯·ç¨å€™...</text>
  </view>
  
  <!-- é”™è¯¯æç¤º -->
  <view wx:if="{{loadError}}" class="error-container">
    <view class="error-card">
      <text class="error-icon">âŒ</text>
      <text class="error-message">é¢˜ç›®ç”Ÿæˆå¤±è´¥: {{errorMsg}}</text>
      <view class="action-buttons">
        <button class="retry-button" bindtap="retryGenerate">é‡è¯•</button>
        <button class="back-button" bindtap="goBack">è¿”å›</button>
      </view>
    </view>
  </view>
</view>