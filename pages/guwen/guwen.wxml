<view class="container">
  <!-- è‡ªå®šä¹‰é¡¶éƒ¨åŒºåŸŸï¼ˆè¿ç§»æ ·å¼é¡µé¢é¡¶éƒ¨ç»“æ„ï¼‰ -->
  <view class="custom-header">
    <image class="header-bg-image" src="https://newlan.oss-cn-shanghai.aliyuncs.com/%E7%95%8C%E9%9D%A2%E8%83%8C%E6%99%AF%E5%9B%BE" mode="aspectFill"></image>
    <view class="status-bar" style="height: {{statusBarHeight}}px;"></view>
    <view class="search-bar">
      <view class="search-container">
        <input 
          class="search-input" 
          placeholder="è¾“å…¥å¤è¯—æ–‡å…³é”®è¯..." 
          bindinput="onInput" 
          value="{{searchKeyword}}"
          bindconfirm="doSearch"
        />
        <view class="search-btn" bindtap="doSearch">æœç´¢</view>
      </view>
    </view>
  </view>

  <!-- å†…å®¹åŒºåŸŸï¼ˆæ•´åˆä¸»ä½“ä¹¦ç±/æ–‡ç« é€»è¾‘ï¼Œç”¨æ ·å¼é¡µé¢ç»“æ„ï¼‰ -->
  <scroll-view 
    class="result-list" 
    scroll-y="true"
    scroll-with-animation="true"
    enable-back-to-top="true"
  >
    <view class="top-spacer"></view>
    
    <block wx:if="{{!loading}}">
      <!-- ç©ºçŠ¶æ€ï¼ˆä¿ç•™ä¸»ä½“é€»è¾‘ï¼‰ -->
      <block wx:if="{{totalCount === 0}}">
        <view class="empty-result">
          <view class="empty-text">
            {{hasSearched ? 'æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„å¤è¯—æ–‡' : 'æš‚æ— å¤è¯—æ–‡æ•°æ®'}}
          </view>
          <view class="empty-tip">
            {{hasSearched ? 'è¯·å°è¯•ä¸åŒçš„å…³é”®è¯' : ''}}
          </view>
        </view>
      </block>
    
      <!-- æœ‰æ•°æ®çŠ¶æ€ï¼ˆæ•´åˆä¸»ä½“æ•°æ®ï¼Œç”¨æ ·å¼é¡µé¢ç»“æ„ï¼‰ -->
      <block wx:else>
        <!-- ç¾¤ç±è—è¯†åŒºåŸŸï¼ˆä¿ç•™ä¸»ä½“â€œæ˜¾ç¤ºå…¨éƒ¨â€æŒ‰é’®ï¼Œç”¨æ ·å¼é¡µé¢å¸ƒå±€ï¼‰ -->
        <view class="qunjicangshi-section">
          <view class="qunjicangshi-header" bindtap="navigateToAllBooks">
            <!-- ä¸»ä½“â€œæ˜¾ç¤ºå…¨éƒ¨â€æŒ‰é’®é€»è¾‘æ•´åˆåˆ°æ­¤å¤„ -->
            <view class="qunjicangshi-title-wrap">
              <view class="qunjicangshi-decorator"></view>
              <text class="qunjicangshi-title">ç¾¤ç±è—è¯†</text>
            </view>
            <image class="qunjicangshi-arrow" src="/images/å³ç®­å¤´.png" mode="aspectFit"></image>
          </view>          
          
          <!-- ä¹¦ç±è½®æ’­å®¹å™¨ï¼ˆç”¨æ ·å¼é¡µé¢scroll-viewï¼Œä¿ç•™ä¸»ä½“åŠ è½½/é”™è¯¯çŠ¶æ€ï¼‰ -->
          <view class="books-carousel-container">
            <view wx:if="{{booksLoading}}" class="books-loading">
              <text>åŠ è½½ä¹¦ç±ä¸­...</text>
            </view>
            <view wx:if="{{booksError}}" class="books-error">
              <text>{{booksError}}</text>
            </view>
            
            <block wx:if="{{booksList.length > 0}}">
              <scroll-view 
                class="books-scroll"
                scroll-x="true"
                scroll-with-animation="true"
                enable-flex="true"
                bindscroll="onCarouselScroll"
                id="booksCarousel"
              >
                <view class="books-list">
                  <block wx:for="{{booksList}}" wx:key="id" wx:for-item="book">
                    <view class="book-card" bindtap="navigateToBookDetail" data-book="{{book}}">
                      <view class="book-img-wrap">
                        <image 
                          class="book-img" 
                          src="{{book.imageError ? book.localFallback : book.safeImage}}" 
                          mode="scaleToFill"
                          binderror="handleBookImgError"
                          data-index="{{index}}"
                          lazy-load="true"
                        ></image>
                      </view>
                      <view class="book-info">
                        <text class="book-title">{{book.title}}</text>
                        <text class="book-author">{{book.author || 'æœªçŸ¥ä½œè€…'}}</text>
                      </view>
                    </view>
                  </block>
                </view>
              </scroll-view>
            </block>
          </view>
        </view>

        <!-- ç®€ç‰æ–‡è¯†åŒºåŸŸï¼ˆè¿ç§»æ ·å¼é¡µé¢ç»“æ„ï¼Œæ›¿æ¢ä¸»ä½“search-headerï¼‰ -->
        <view class="jianduwenshi-section">
          <view class="jianduwenshi-title-wrap">
            <view class="jianduwenshi-decorator"></view>
            <text class="jianduwenshi-title">ç®€ç‰æ–‡è¯†</text>
          </view>
          <view class="jianduwenshi-count">
            {{hasSearched ? 'æ‰¾åˆ° ' + totalCount + ' æ¡åŒ¹é…ç»“æœ' : 'å…± ' + totalCount + ' æ¡'}}
          </view>
        </view>
        
        <!-- æ–‡ç« åˆ—è¡¨å¡ç‰‡ï¼ˆç”¨æ ·å¼é¡µé¢article-cardï¼Œä¿ç•™ä¸»ä½“æ•°æ®ç»‘å®šï¼‰ -->
        <block wx:for="{{searchResults}}" wx:key="id">
          <view 
            class="article-card" 
            bindtap="navigateToDetail"
            data-item="{{item}}"  
            data-id="{{item.id}}" 
            data-index="{{index}}" 
          >
            <text class="article-title">{{item.title}}</text>
            <view class="article-info">
              <text class="article-author">{{item.author || 'æœªçŸ¥'}}</text>
              <text class="article-dynasty">{{item.dynasty || 'ä¸è¯¦'}}</text>
            </view>
            <text class="article-content">{{item.content || item.description}}</text>
          </view>
        </block>
      </block>
    </block>
    
    <!-- åŠ è½½çŠ¶æ€ï¼ˆç»Ÿä¸€ä¸ºæ ·å¼é¡µé¢çš„loadingï¼‰ -->
    <view class="loading" wx:if="{{loading}}">
      <text>åŠ è½½ä¸­...</text>
    </view>
    
    <view class="bottom-spacer"></view>
  </scroll-view>
  
  <!-- åˆ†é¡µæ ï¼ˆä¿ç•™ä¸»ä½“é€»è¾‘ï¼Œç”¨æ ·å¼é¡µé¢æ ·å¼ï¼‰ -->
  <view class="pagination-container" wx:if="{{totalCount > 0 && searchResults.length > 0}}">
    <text class="total-count">æ€»è®¡ {{totalCount}}</text>
    <view class="pagination-controls">
      <view 
        class="pagination-arrow {{currentPage === 1 ? 'disabled' : ''}}" 
        bindtap="goToPrevPage"
      >
        <image src="https://newlan.oss-cn-shanghai.aliyuncs.com/icons/%E5%B7%A6%E7%AE%AD%E5%A4%B4.jpg" class="arrow-icon" mode="aspectFit" />
      </view>
      <view class="page-current-container">
        <text>{{currentPage}}</text>
      </view>
      <view 
        class="pagination-arrow {{currentPage === totalPages ? 'disabled' : ''}}" 
        bindtap="goToNextPage"
      >
        <image src="https://newlan.oss-cn-shanghai.aliyuncs.com/icons/%E5%8F%B3%E7%AE%AD%E5%A4%B4.jpg" class="arrow-icon" mode="aspectFit" />
      </view>
      <view class="goto-group">
        <text class="goto-label">è½¬åˆ°</text>
        <input 
          class="goto-input" 
          type="number" 
          placeholder="é¡µç " 
          value="{{gotoPage}}"
          bindinput="onGotoInput"
        />
      </view>
      <button class="goto-button" bindtap="goToSpecifiedPage">è·³è½¬</button>
    </view>
  </view>
</view>

<!-- æµ®åŠ¨å¯¼èˆªæŒ‰é’®ï¼ˆä¿ç•™ä¸»ä½“åŠŸèƒ½ï¼Œç”¨æ ·å¼é¡µé¢æ ·å¼ï¼‰ -->
<view class="float-nav-tool" bindtap="navigateToIndex">
  <text class="float-nav-icon">ğŸ </text>
</view>