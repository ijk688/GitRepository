<view class="container">
  <!-- é¡¶éƒ¨æ ‡é¢˜åŒºåŸŸ -->
  <view class="header">
    <!-- <view class="back-btn" bindtap="goBack"> -->
      <!-- <image src="/icons/back.png" class="back-icon" /> -->
    <!-- </view> -->
    <view class="title">
      <text class="title-text">èƒŒè¯µç»ƒä¹ </text>
      <view class="title-decoration"></view>
    </view>
  </view>
  
  <!-- å½“å‰èƒŒè¯µå¤è¯—æ˜¾ç¤º -->
  <view class="poem-display" wx:if="{{currentPoemName}}">
    <view class="section-title">
      <view class="icon">ğŸ“œ</view>
      <text class="title-text">å½“å‰èƒŒè¯µå¤è¯—</text>
      <view class="title-decoration"></view>
    </view>
    <view class="poem-name">{{currentPoemName}}</view>
  </view>
  
  <!-- è¯­éŸ³å½•åˆ¶åŒºåŸŸ -->
  <view class="recording-section" wx:if="{{!hasUploaded}}">
    <view class="section-title">
      <view class="icon">ğŸ¤</view>
      <text class="title-text">è¯­éŸ³èƒŒè¯µå½•éŸ³</text>
      <view class="title-decoration"></view>
    </view>
    
    <view class="recording-status">
      <view class="recording-icon-container">
        <view class="recording-icon {{isRecording ? 'pulse' : ''}}">
          {{isRecording ? 'ğŸ”´' : 'âšª'}}
        </view>
        <view class="yin-yang"></view>
      </view>
      <view class="recording-text">
        {{isRecording ? 'å½•éŸ³ä¸­...' : 'ç‚¹å‡»å¼€å§‹å½•éŸ³'}}
      </view>
      <view class="recording-time" wx:if="{{isRecording}}">
        {{formatTime(recordingTime)}}
      </view>
    </view>
    
    <!-- å½•éŸ³æ§åˆ¶æŒ‰é’® -->
    <view class="recording-controls">
      <button 
        class="btn {{isRecording ? 'btn-stop' : 'btn-record'}}" 
        bindtap="{{isRecording ? 'stopRecording' : 'startRecording'}}"
        disabled="{{isRecording && recordingTime < 3}}"
      >
        <text>{{isRecording ? 'åœæ­¢å½•éŸ³' : 'å¼€å§‹å½•éŸ³'}}</text>
        <view class="btn-icon">{{isRecording ? 'â¹ï¸' : 'ğŸ¤'}}</view>
        <view class="btn-decoration"></view>
      </button>
      
      <button 
        class="btn btn-play" 
        bindtap="playRecording" 
        disabled="{{!audioFilePath || isRecording}}"
        wx:if="{{audioFilePath && !isRecording}}"
      >
        <text>æ’­æ”¾å½•éŸ³</text>
        <view class="btn-icon">â–¶ï¸</view>
        <view class="btn-decoration"></view>
      </button>
    </view>
    
    <!-- å½•éŸ³æ³¢å½¢æ˜¾ç¤º -->
    <view class="waveform" wx:if="{{isRecording}}">
      <view 
        class="wave-bar" 
        wx:for="{{waveformData}}" 
        wx:key="index"
        style="height: {{item}}rpx;"
      ></view>
    </view>
    
    <!-- å½•éŸ³æ–‡ä»¶ä¿¡æ¯ -->
    <view class="recording-info" wx:if="{{audioFilePath && !isRecording}}">
      <view class="info-item">
        <text class="label">å½•éŸ³æ—¶é•¿ï¼š</text>
        <text class="value">{{formatTime(recordingTime)}}</text>
      </view>
      <view class="info-item">
        <text class="label">æ–‡ä»¶å¤§å°ï¼š</text>
        <text class="value">{{audioFileSize}} KB</text>
      </view>
      <view class="info-item">
        <text class="label">å½•éŸ³æ—¶é—´ï¼š</text>
        <text class="value">{{recordingTimestamp}}</text>
      </view>
    </view>
    
    <!-- ä¸Šä¼ æŒ‰é’® -->
    <button class="btn btn-primary upload-btn" bindtap="uploadAndEvaluate" disabled="{{!audioFilePath}}">
      <text>ä¸Šä¼ å¹¶è·å–ç‚¹è¯„</text>
      <view class="btn-icon">ğŸš€</view>
      <view class="btn-decoration"></view>
    </button>
  </view>
  
  <!-- ç‚¹è¯„ç»“æœå±•ç¤º -->
  <view class="evaluation-section" wx:if="{{hasUploaded && !loading && !error}}">
    <view class="section-title">
      <view class="icon">ğŸ“</view>
      <text class="title-text">AIç‚¹è¯„ç»“æœ</text>
      <view class="title-decoration"></view>
    </view>
    
    <view class="evaluation-content">
      <!-- æ€»ä½“è¯„åˆ† -->
      <view class="evaluation-item">
        <view class="evaluation-label">æ€»ä½“è¯„åˆ†ï¼š</view>
        <view class="evaluation-text">
          {{overallScore}}åˆ†
          <view class="score-decoration"></view>
        </view>
      </view>
      
      <!-- è¯¦ç»†è¯„åˆ† -->
      <view class="evaluation-item">
        <view class="evaluation-label">è¯¦ç»†è¯„åˆ†ï¼š</view>
        <view class="detail-scores">
          <view class="detail-item">
            <view class="detail-value">{{detailedScores.content_completeness}}</view>
            <view class="detail-label">å†…å®¹å®Œæ•´åº¦</view>
            <view class="detail-decoration"></view>
          </view>
          <view class="detail-item">
            <view class="detail-value">{{detailedScores.structural_correctness}}</view>
            <view class="detail-label">ç»“æ„æ­£ç¡®æ€§</view>
            <view class="detail-decoration"></view>
          </view>
          <view class="detail-item">
            <view class="detail-value">{{detailedScores.key_imagery_preservation}}</view>
            <view class="detail-label">å…³é”®æ„è±¡ä¿ç•™</view>
            <view class="detail-decoration"></view>
          </view>
        </view>
      </view>
      
      <!-- ä¸»è¦é”™è¯¯ -->
      <view class="evaluation-item" wx:if="{{majorErrors.length > 0}}">
        <view class="evaluation-label">ä¸»è¦é”™è¯¯ï¼š</view>
        <view class="error-list">
          <view class="error-item" wx:for="{{majorErrors}}" wx:key="index">
            <view class="error-header">
              <view class="error-type">{{item.error_type}}</view>
              <view class="severity {{item.severity}}">{{item.severity}}</view>
            </view>
            <view class="error-detail">
              <text class="label">ä½ç½®ï¼š</text>
              <text class="value">{{item.position}}</text>
            </view>
            <view class="error-detail">
              <text class="label">ç¼ºå¤±å†…å®¹ï¼š</text>
              <text class="value">{{item.missing_content}}</text>
            </view>
            <view class="error-decoration"></view>
          </view>
        </view>
      </view>
      
      <!-- è¡¨æ‰¬ -->
      <view class="evaluation-item">
        <view class="evaluation-label">è¡¨æ‰¬ï¼š</view>
        <view class="evaluation-text">{{feedback.praise}}</view>
      </view>
      
      <!-- æ”¹è¿›å»ºè®® -->
      <view class="evaluation-item">
        <view class="evaluation-label">æ”¹è¿›å»ºè®®ï¼š</view>
        <view class="evaluation-suggestions">
          <block wx:for="{{feedback.suggestions}}" wx:key="index">
            <view class="suggestion-item">
              <text class="suggestion-index">{{index + 1}}.</text>
              <text class="suggestion-text">{{item}}</text>
              <view class="suggestion-decoration"></view>
            </view>
          </block>
        </view>
      </view>
    </view>
    
    <!-- é‡æ–°ä¸Šä¼ æŒ‰é’® -->
    <view class="reupload-section">
      <button class="btn btn-reupload" bindtap="reUpload">
        <text>é‡æ–°èƒŒè¯µå¹¶ä¸Šä¼ </text>
        <view class="btn-icon">ğŸ”„</view>
        <view class="btn-decoration"></view>
      </button>
    </view>
  </view>
  
  <!-- é”™è¯¯æç¤º -->
  <view class="error-section" wx:if="{{error}}">
    <text class="error-text">{{error}}</text>
    <button class="btn btn-retry" bindtap="retryUpload">
      <text>é‡è¯•</text>
      <view class="btn-decoration"></view>
    </button>
  </view>
  
  <!-- æ–°å¢ï¼šæŒ‘æˆ˜æŒ‰é’® -->
  <view class="challenge-btn-container">
    <button class="btn btn-challenge" bindtap="goToChallengePage">
      <text>èƒŒè¯µè®°å½•</text>
      <view class="btn-icon">ğŸ†</view>
      <view class="btn-decoration"></view>
    </button>
  </view>
</view>